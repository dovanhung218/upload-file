{"ast":null,"code":"/**\r\n * JSON Format Plugin\r\n *\r\n * @module plugins/json\r\n * @license [MIT]{@link https://github.com/archiverjs/node-archiver/blob/master/LICENSE}\r\n * @copyright (c) 2012-2014 Chris Talkington, contributors.\r\n */\nvar inherits = require('util').inherits;\nvar Transform = require('readable-stream').Transform;\nvar crc32 = require('buffer-crc32');\nvar util = require('archiver-utils');\n\n/**\r\n * @constructor\r\n * @param {(JsonOptions|TransformOptions)} options\r\n */\nvar Json = function (options) {\n  if (!(this instanceof Json)) {\n    return new Json(options);\n  }\n  options = this.options = util.defaults(options, {});\n  Transform.call(this, options);\n  this.supports = {\n    directory: true,\n    symlink: true\n  };\n  this.files = [];\n};\ninherits(Json, Transform);\n\n/**\r\n * [_transform description]\r\n *\r\n * @private\r\n * @param  {Buffer}   chunk\r\n * @param  {String}   encoding\r\n * @param  {Function} callback\r\n * @return void\r\n */\nJson.prototype._transform = function (chunk, encoding, callback) {\n  callback(null, chunk);\n};\n\n/**\r\n * [_writeStringified description]\r\n *\r\n * @private\r\n * @return void\r\n */\nJson.prototype._writeStringified = function () {\n  var fileString = JSON.stringify(this.files);\n  this.write(fileString);\n};\n\n/**\r\n * [append description]\r\n *\r\n * @param  {(Buffer|Stream)}   source\r\n * @param  {EntryData}   data\r\n * @param  {Function} callback\r\n * @return void\r\n */\nJson.prototype.append = function (source, data, callback) {\n  var self = this;\n  data.crc32 = 0;\n  function onend(err, sourceBuffer) {\n    if (err) {\n      callback(err);\n      return;\n    }\n    data.size = sourceBuffer.length || 0;\n    data.crc32 = crc32.unsigned(sourceBuffer);\n    self.files.push(data);\n    callback(null, data);\n  }\n  if (data.sourceType === 'buffer') {\n    onend(null, source);\n  } else if (data.sourceType === 'stream') {\n    util.collectStream(source, onend);\n  }\n};\n\n/**\r\n * [finalize description]\r\n *\r\n * @return void\r\n */\nJson.prototype.finalize = function () {\n  this._writeStringified();\n  this.end();\n};\nmodule.exports = Json;\n\n/**\r\n * @typedef {Object} JsonOptions\r\n * @global\r\n */","map":{"version":3,"names":["inherits","require","Transform","crc32","util","Json","options","defaults","call","supports","directory","symlink","files","prototype","_transform","chunk","encoding","callback","_writeStringified","fileString","JSON","stringify","write","append","source","data","self","onend","err","sourceBuffer","size","length","unsigned","push","sourceType","collectStream","finalize","end","module","exports"],"sources":["/Users/abc/Downloads/Workspace/c2i/image-text/c2i-convert/node_modules/archiver/lib/plugins/json.js"],"sourcesContent":["/**\r\n * JSON Format Plugin\r\n *\r\n * @module plugins/json\r\n * @license [MIT]{@link https://github.com/archiverjs/node-archiver/blob/master/LICENSE}\r\n * @copyright (c) 2012-2014 Chris Talkington, contributors.\r\n */\r\nvar inherits = require('util').inherits;\r\nvar Transform = require('readable-stream').Transform;\r\n\r\nvar crc32 = require('buffer-crc32');\r\nvar util = require('archiver-utils');\r\n\r\n/**\r\n * @constructor\r\n * @param {(JsonOptions|TransformOptions)} options\r\n */\r\nvar Json = function(options) {\r\n  if (!(this instanceof Json)) {\r\n    return new Json(options);\r\n  }\r\n\r\n  options = this.options = util.defaults(options, {});\r\n\r\n  Transform.call(this, options);\r\n\r\n  this.supports = {\r\n    directory: true,\r\n    symlink: true\r\n  };\r\n\r\n  this.files = [];\r\n};\r\n\r\ninherits(Json, Transform);\r\n\r\n/**\r\n * [_transform description]\r\n *\r\n * @private\r\n * @param  {Buffer}   chunk\r\n * @param  {String}   encoding\r\n * @param  {Function} callback\r\n * @return void\r\n */\r\nJson.prototype._transform = function(chunk, encoding, callback) {\r\n  callback(null, chunk);\r\n};\r\n\r\n/**\r\n * [_writeStringified description]\r\n *\r\n * @private\r\n * @return void\r\n */\r\nJson.prototype._writeStringified = function() {\r\n  var fileString = JSON.stringify(this.files);\r\n  this.write(fileString);\r\n};\r\n\r\n/**\r\n * [append description]\r\n *\r\n * @param  {(Buffer|Stream)}   source\r\n * @param  {EntryData}   data\r\n * @param  {Function} callback\r\n * @return void\r\n */\r\nJson.prototype.append = function(source, data, callback) {\r\n  var self = this;\r\n\r\n  data.crc32 = 0;\r\n\r\n  function onend(err, sourceBuffer) {\r\n    if (err) {\r\n      callback(err);\r\n      return;\r\n    }\r\n\r\n    data.size = sourceBuffer.length || 0;\r\n    data.crc32 = crc32.unsigned(sourceBuffer);\r\n\r\n    self.files.push(data);\r\n\r\n    callback(null, data);\r\n  }\r\n\r\n  if (data.sourceType === 'buffer') {\r\n    onend(null, source);\r\n  } else if (data.sourceType === 'stream') {\r\n    util.collectStream(source, onend);\r\n  }\r\n};\r\n\r\n/**\r\n * [finalize description]\r\n *\r\n * @return void\r\n */\r\nJson.prototype.finalize = function() {\r\n  this._writeStringified();\r\n  this.end();\r\n};\r\n\r\nmodule.exports = Json;\r\n\r\n/**\r\n * @typedef {Object} JsonOptions\r\n * @global\r\n */\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIA,QAAQ,GAAGC,OAAO,CAAC,MAAM,CAAC,CAACD,QAAQ;AACvC,IAAIE,SAAS,GAAGD,OAAO,CAAC,iBAAiB,CAAC,CAACC,SAAS;AAEpD,IAAIC,KAAK,GAAGF,OAAO,CAAC,cAAc,CAAC;AACnC,IAAIG,IAAI,GAAGH,OAAO,CAAC,gBAAgB,CAAC;;AAEpC;AACA;AACA;AACA;AACA,IAAII,IAAI,GAAG,UAASC,OAAO,EAAE;EAC3B,IAAI,EAAE,IAAI,YAAYD,IAAI,CAAC,EAAE;IAC3B,OAAO,IAAIA,IAAI,CAACC,OAAO,CAAC;EAC1B;EAEAA,OAAO,GAAG,IAAI,CAACA,OAAO,GAAGF,IAAI,CAACG,QAAQ,CAACD,OAAO,EAAE,CAAC,CAAC,CAAC;EAEnDJ,SAAS,CAACM,IAAI,CAAC,IAAI,EAAEF,OAAO,CAAC;EAE7B,IAAI,CAACG,QAAQ,GAAG;IACdC,SAAS,EAAE,IAAI;IACfC,OAAO,EAAE;EACX,CAAC;EAED,IAAI,CAACC,KAAK,GAAG,EAAE;AACjB,CAAC;AAEDZ,QAAQ,CAACK,IAAI,EAAEH,SAAS,CAAC;;AAEzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAG,IAAI,CAACQ,SAAS,CAACC,UAAU,GAAG,UAASC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE;EAC9DA,QAAQ,CAAC,IAAI,EAAEF,KAAK,CAAC;AACvB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACAV,IAAI,CAACQ,SAAS,CAACK,iBAAiB,GAAG,YAAW;EAC5C,IAAIC,UAAU,GAAGC,IAAI,CAACC,SAAS,CAAC,IAAI,CAACT,KAAK,CAAC;EAC3C,IAAI,CAACU,KAAK,CAACH,UAAU,CAAC;AACxB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAd,IAAI,CAACQ,SAAS,CAACU,MAAM,GAAG,UAASC,MAAM,EAAEC,IAAI,EAAER,QAAQ,EAAE;EACvD,IAAIS,IAAI,GAAG,IAAI;EAEfD,IAAI,CAACtB,KAAK,GAAG,CAAC;EAEd,SAASwB,KAAK,CAACC,GAAG,EAAEC,YAAY,EAAE;IAChC,IAAID,GAAG,EAAE;MACPX,QAAQ,CAACW,GAAG,CAAC;MACb;IACF;IAEAH,IAAI,CAACK,IAAI,GAAGD,YAAY,CAACE,MAAM,IAAI,CAAC;IACpCN,IAAI,CAACtB,KAAK,GAAGA,KAAK,CAAC6B,QAAQ,CAACH,YAAY,CAAC;IAEzCH,IAAI,CAACd,KAAK,CAACqB,IAAI,CAACR,IAAI,CAAC;IAErBR,QAAQ,CAAC,IAAI,EAAEQ,IAAI,CAAC;EACtB;EAEA,IAAIA,IAAI,CAACS,UAAU,KAAK,QAAQ,EAAE;IAChCP,KAAK,CAAC,IAAI,EAAEH,MAAM,CAAC;EACrB,CAAC,MAAM,IAAIC,IAAI,CAACS,UAAU,KAAK,QAAQ,EAAE;IACvC9B,IAAI,CAAC+B,aAAa,CAACX,MAAM,EAAEG,KAAK,CAAC;EACnC;AACF,CAAC;;AAED;AACA;AACA;AACA;AACA;AACAtB,IAAI,CAACQ,SAAS,CAACuB,QAAQ,GAAG,YAAW;EACnC,IAAI,CAAClB,iBAAiB,EAAE;EACxB,IAAI,CAACmB,GAAG,EAAE;AACZ,CAAC;AAEDC,MAAM,CAACC,OAAO,GAAGlC,IAAI;;AAErB;AACA;AACA;AACA"},"metadata":{},"sourceType":"script","externalDependencies":[]}